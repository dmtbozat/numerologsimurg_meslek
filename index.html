<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Numeroloji Meslek Hesaplama</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      margin: 0;
      padding: 0;
    }

    .container {
      width: 50%;
      margin: 50px auto;
      background-color: white;
      padding: 20px;
      box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
    }

    h1 {
      text-align: center;
    }

    label {
      display: block;
      margin: 10px 0 5px;
    }

    input {
      width: 100%;
      padding: 8px;
      margin-bottom: 10px;
    }

    button {
      background-color: #4CAF50;
      color: white;
      padding: 10px 20px;
      border: none;
      cursor: pointer;
      width: 100%;
    }

    button:hover {
      background-color: #45a049;
    }

    #result {
      margin-top: 20px;
      display: none;
    }

    ul {
      list-style-type: none;
    }

    ul li {
      padding: 5px 0;
    }

    #downloadPDF {
      margin-top: 20px;
      background-color: #007BFF;
      color: white;
      padding: 10px 20px;
      border: none;
      cursor: pointer;
      width: 100%;
    }

    #downloadPDF:hover {
      background-color: #0056b3;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Numerolojiye Göre Meslek Hesaplama</h1>
    <form id="numerologyForm">
      <label for="firstName">İsim:</label>
      <input type="text" id="firstName" name="firstName" required>

      <label for="lastName">Soyisim:</label>
      <input type="text" id="lastName" name="lastName" required>

      <label for="maidenName">Kızlık Soyadı (isteğe bağlı):</label>
      <input type="text" id="maidenName" name="maidenName">

      <button type="submit">Hesapla</button>
    </form>

    <div id="result">
      <h2>Numerolojik Meslek Sayısı:</h2>
      <p id="professionNumber"></p>
      <h3>Meslekler:</h3>
      <ul id="professionList"></ul>
      <h3>Açıklama:</h3>
      <p id="explanationText"></p>
      <button id="downloadPDF">PDF Olarak İndir</button>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
  <script>
    /***********************
     * 0) METİN TEMİZLEME (EKRAN + PDF)
     ***********************/
    function fixSpacedLetters(str) {
      str = (str || "").trim();
      const tokens = str.split(/\s+/);
      if (tokens.length >= 8) {
        const singleCharCount = tokens.filter(t => t.length === 1).length;
        if (singleCharCount / tokens.length > 0.7) {
          return tokens.join("");
        }
      }
      return str;
    }

    function cleanTitleText(str) {
      return fixSpacedLetters( 
        (str || "")
        .replace(/[\u200B-\u200D\uFEFF]/g, "")
        .replace(/\s+/g, " ")
        .trim() 
      );
    }

    function trToAscii(str) {
      if (!str) return "";
      const map = {
        "ç":"c", "Ç":"C", "ğ":"g", "Ğ":"G", "ş":"s", "Ş":"S", 
        "ö":"o", "Ö":"O", "ü":"u", "Ü":"U", "ı":"i", "İ":"I"
      };
      return str.replace(/[çÇğĞşŞöÖüÜıİ]/g, ch => map[ch] || ch);
    }

    function cleanPdfText(str) {
      return trToAscii(str || "")
        .replace(/[\u200B-\u200D\uFEFF]/g, "")
        .replace(/[–—−]/g, "-")
        .replace(/→/g, "->")
        .replace(/[“”]/g, '"')
        .replace(/[’‘]/g, "'")
        .replace(/\r/g, "");
    }

    /***********************
     * 1) HARF - SAYI MAP
     ***********************/
    const numberMap = {
      A:1, B:2, C:3, Ç:3, D:4, E:5, F:6, G:7, Ğ:7, H:8, I:9, İ:9, J:1,
      K:2, L:3, M:4, N:5, O:6, Ö:6, P:7, R:9, S:1, Ş:1, T:2, U:3, Ü:3,
      V:4, Y:7, Z:8, W:5, Q:8, X:6 
    };

    const vowels = "AEIİOÖUÜ";

    const rows = [
      { row: 1, letters: "AJSŞ" },
      { row: 2, letters: "BKT" },
      { row: 3, letters: "CÇLUÜ" },
      { row: 4, letters: "DMV" },
      { row: 5, letters: "ENW" },
      { row: 6, letters: "FOÖX" },
      { row: 7, letters: "GĞPY" },
      { row: 8, letters: "HQZ" },
      { row: 9, letters: "İIR" }
    ];

    /***********************
     * 2) MASTER SAYILAR
     ***********************/
    const masterNumbers = new Set([11, 19, 22, 33]);

    function sadeleştir(num) {
      if (masterNumbers.has(num)) return num;
      while (num > 9) {
        num = num.toString().split("").reduce((a, b) => a + Number(b), 0);
        if (masterNumbers.has(num)) return num;
      }
      return num;
    }

    /***********************
     * 3) NUMEROLOJİK HESAPLAMA
     ***********************/
    document.getElementById('numerologyForm').addEventListener('submit', function(event) {
      event.preventDefault();
      
      const firstName = document.getElementById('firstName').value;
      const lastName = document.getElementById('lastName').value;
      const maidenName = document.getElementById('maidenName').value;

      // JSON dosyasını sunucudan çekiyoruz
      fetch('uygun_meslekler.json') // JSON dosyanızın yolu burada
        .then(response => response.json())
        .then(data => {
          const totalSum = calculateNumerology(firstName + lastName + maidenName);

          // Meslek ve açıklamalar
          const professionList = data[totalSum] ? data[totalSum].meslekler : [];
          const explanation = data[totalSum] ? data[totalSum].aciklama : '';

          // Sayıyı ekrana yazdırma
          document.getElementById('professionNumber').textContent = totalSum;

          // Meslekleri listeleme
          const professionListElement = document.getElementById('professionList');
          professionListElement.innerHTML = '';
          professionList.forEach(profession => {
            const listItem = document.createElement('li');
            listItem.textContent = profession;
            professionListElement.appendChild(listItem);
          });

          // Açıklama ekleme
          document.getElementById('explanationText').textContent = explanation;

          // PDF İndirme Butonunu Görünür Hale Getir
          document.getElementById('result').style.display = 'block';

          // PDF indirme fonksiyonu
          document.getElementById('downloadPDF').addEventListener('click', function() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.setFont("helvetica");  // Türkçe karakterler için uyumlu font

            // Başlık
            doc.text("Numerolojiye Göre Demet Bozat İçin Uygun Meslekler", 20, 20);
            doc.text("Meslek Sayısı: " + totalSum, 20, 30);

            let yPosition = 40;
            
            // Meslekleri PDF'ye ekle
            professionList.forEach(profession => {
              doc.text(profession, 20, yPosition);
              yPosition += 10;
            });

            // Açıklama ekle
            yPosition += 10;
            doc.text("Açıklama:", 20, yPosition);
            yPosition += 10;
            doc.text(explanation, 20, yPosition);

            doc.save('meslek_sayisi.pdf');
          });
        })
        .catch(error => console.error('JSON dosyası yüklenemedi:', error));
    });

    function calculateNumerology(name) {
      // Türkçe harfleri İngilizce'ye çevirme
      const turkishToEnglish = {
        'ç': 'c', 'ı': 'i', 'ğ': 'g', 'ş': 's', 'ö': 'o', 'ü': 'u',
        'Ç': 'C', 'İ': 'I', 'Ğ': 'G', 'Ş': 'S', 'Ö': 'O', 'Ü': 'U',
        'ı': 'i' // 'ı' harfini 'i' olarak dönüştür
      };

      // Türkçe karakterleri İngilizce'ye dönüştür
      name = name.replace(/[çığşöüÇİĞŞÖÜı]/g, match => turkishToEnglish[match]);

      const alphabet = { A: 1, B: 2, C: 3, D: 4, E: 5, F: 6, G: 7, H: 8, I: 9, J: 1, K: 2, L: 3, M: 4, N: 5, O: 6, P: 7, Q: 8, R: 9, S: 1, T: 2, U: 3, V: 4, W: 5, X: 6, Y: 7, Z: 8 };
      let sum = 0;

      // Her harfin karşılık geldiği sayıyı topla
      for (let i = 0; i < name.length; i++) {
        const letter = name[i].toUpperCase();
        if (alphabet[letter]) {
          sum += alphabet[letter];
        }
      }

      // Toplamı 9'a kadar sadeleştir
      while (sum > 9) {
        sum = sum.toString().split('').reduce((acc, curr) => acc + parseInt(curr), 0);
      }

      return sum;
    }
  </script>
</body>
</html>
