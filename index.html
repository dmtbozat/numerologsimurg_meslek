<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Numeroloji Meslek Hesaplama</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f5f5f5;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    .container {
      width: 80%;
      max-width: 800px;
      background-color: white;
      padding: 30px;
      box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.1);
      border-radius: 10px;
    }

    h1 {
      text-align: center;
      margin-bottom: 20px;
      font-size: 24px;
      color: #333;
    }

    label {
      display: block;
      margin: 8px 0;
      font-weight: bold;
    }

    input {
      width: 100%;
      padding: 12px;
      margin-bottom: 16px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 16px;
    }

    button {
      width: 100%;
      padding: 12px;
      background-color: #1e88e5;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
    }

    button:hover {
      background-color: #1565c0;
    }

    #result {
      margin-top: 30px;
      display: none;
      background-color: #f0f4ff;
      padding: 20px;
      border-radius: 8px;
    }

    .result-title {
      font-size: 18px;
      font-weight: bold;
    }

    .result-text {
      font-size: 16px;
      margin-top: 10px;
    }

    #downloadPDF {
      background-color: #4caf50;
      color: white;
      margin-top: 20px;
    }

    #downloadPDF:hover {
      background-color: #388e3c;
    }

    .statusLine {
      text-align: center;
      margin-top: 10px;
      font-size: 14px;
    }

    .statusOk {
      color: #2e7d32;
    }

    .statusBad {
      color: #c62828;
    }

  </style>
</head>
<body>
  <div class="container">
    <h1>Numerolojiye Göre Meslek Hesaplama</h1>
    <form id="numerologyForm">
      <label for="firstName">İsim:</label>
      <input type="text" id="firstName" name="firstName" required>

      <label for="lastName">Soyisim:</label>
      <input type="text" id="lastName" name="lastName" required>

      <label for="maidenName">Kızlık Soyadı (isteğe bağlı):</label>
      <input type="text" id="maidenName" name="maidenName">

      <button type="submit">Hesapla</button>
    </form>

    <div id="result">
      <div class="result-title">Numerolojik Meslek Sayısı:</div>
      <div class="result-text" id="professionNumber"></div>

      <div class="result-title">Meslekler:</div>
      <ul id="professionList"></ul>

      <div class="result-title">Açıklama:</div>
      <div class="result-text" id="explanationText"></div>

      <button id="downloadPDF">PDF Olarak İndir</button>
    </div>

    <div class="statusLine" id="jsonStatus">
      JSON durumu: <span class="statusBad">yükleniyor...</span>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    /***********************
     * METİN TEMİZLEME
     ***********************/
    function fixSpacedLetters(str) {
      str = (str || "").trim();
      const tokens = str.split(/\s+/);
      if (tokens.length >= 8) {
        const singleCharCount = tokens.filter(t => t.length === 1).length;
        if (singleCharCount / tokens.length > 0.7) {
          return tokens.join("");
        }
      }
      return str;
    }

    function trToAscii(str) {
      if (!str) return "";
      const map = {
        "ç":"c", "Ç":"C", "ğ":"g", "Ğ":"G", "ş":"s", "Ş":"S", 
        "ö":"o", "Ö":"O", "ü":"u", "Ü":"U", "ı":"i", "İ":"I"
      };
      return str.replace(/[çÇğĞşŞöÖüÜıİ]/g, ch => map[ch] || ch);
    }

    function cleanPdfText(str) {
      return trToAscii(str || "")
        .replace(/[\u200B-\u200D\uFEFF]/g, "")
        .replace(/[–—−]/g, "-")
        .replace(/→/g, "->")
        .replace(/[“”]/g, '"')
        .replace(/[’‘]/g, "'")
        .replace(/\r/g, "");
    }

    /***********************
     * HARF - SAYI MAP
     ***********************/
    const numberMap = {
      A:1, B:2, C:3, Ç:3, D:4, E:5, F:6, G:7, Ğ:7, H:8, I:9, İ:9, J:1,
      K:2, L:3, M:4, N:5, O:6, Ö:6, P:7, R:9, S:1, Ş:1, T:2, U:3, Ü:3,
      V:4, Y:7, Z:8, W:5, Q:8, X:6 
    };

    const vowels = "AEIİOÖUÜ";

    /***********************
     * NUMEROLOJİK HESAPLAMA
     ***********************/
    document.getElementById('numerologyForm').addEventListener('submit', function(event) {
      event.preventDefault();
      
      const firstName = document.getElementById('firstName').value;
      const lastName = document.getElementById('lastName').value;
      const maidenName = document.getElementById('maidenName').value;

      fetch('uygun_meslekler.json') // JSON dosyanızın yolu burada
        .then(response => response.json())
        .then(data => {
          const totalSum = calculateNumerology(firstName + lastName + maidenName);

          // Meslekler ve açıklama
          const professionList = data[totalSum] ? data[totalSum].meslekler : [];
          const explanation = data[totalSum] ? data[totalSum].aciklama : '';

          // Sayıyı ekrana yazdırma
          document.getElementById('professionNumber').textContent = totalSum;

          // Meslekleri listeleme
          const professionListElement = document.getElementById('professionList');
          professionListElement.innerHTML = '';
          professionList.forEach(profession => {
            const listItem = document.createElement('li');
            listItem.textContent = profession;
            professionListElement.appendChild(listItem);
          });

          // Açıklama ekleme
          document.getElementById('explanationText').textContent = explanation;

          // PDF İndirme Butonunu Görünür Hale Getir
          document.getElementById('result').style.display = 'block';

          // PDF indirme fonksiyonu
          document.getElementById('downloadPDF').addEventListener('click', function() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.setFont("helvetica");

            // Başlık
            doc.text("Numerolojiye Göre Meslek Hesaplama", 20, 20);
            doc.text("Meslek Sayısı: " + totalSum, 20, 30);

            let yPosition = 40;
            
            // Meslekleri PDF'ye ekle
            professionList.forEach(profession => {
              doc.text(profession, 20, yPosition);
              yPosition += 10;
            });

            // Açıklama ekle
            yPosition += 10;
            doc.text("Açıklama:", 20, yPosition);
            yPosition += 10;
            doc.text(explanation, 20, yPosition);

            doc.save('meslek_sayisi.pdf');
          });
        })
        .catch(error => console.error('JSON dosyası yüklenemedi:', error));
    });

    function calculateNumerology(name) {
      const turkishToEnglish = {
        'ç': 'c', 'ı': 'i', 'ğ': 'g', 'ş': 's', 'ö': 'o', 'ü': 'u',
        'Ç': 'C', 'İ': 'I', 'Ğ': 'G', 'Ş': 'S', 'Ö': 'O', 'Ü': 'U',
        'ı': 'i'
      };

      name = name.replace(/[çığşöüÇİĞŞÖÜı]/g, match => turkishToEnglish[match]);

      const alphabet = { A: 1, B: 2, C: 3, D: 4, E: 5, F: 6, G: 7, H: 8, I: 9, J: 1, K: 2, L: 3, M: 4, N: 5, O: 6, P: 7, Q: 8, R: 9, S: 1, T: 2, U: 3, V: 4, W: 5, X: 6, Y: 7, Z: 8 };
      let sum = 0;

      for (let i = 0; i < name.length; i++) {
        const letter = name[i].toUpperCase();
        if (alphabet[letter]) {
          sum += alphabet[letter];
        }
      }

      while (sum > 9) {
        sum = sum.toString().split('').reduce((acc, curr) => acc + parseInt(curr), 0);
      }

      return sum;
    }
  </script>
</body>
</html>
